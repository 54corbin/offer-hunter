(()=>{"use strict";console.log("Answer Generation content script loaded."),console.log("Answer Generation: DOM ready state:",document.readyState),console.log("Answer Generation: Current URL:",window.location.href),console.log("Answer Generation: Creating AnswerGenerationManager instance");const e=new class{constructor(){this.popupState={isVisible:!1,position:{x:0,y:0},selectedText:""},this.popupElement=null,this.hideTimeout=null,this.init()}init(){console.log("Answer Generation: Initializing AnswerGenerationManager"),console.log("Answer Generation: Document ready state:",document.readyState),this.createPopup(),this.addEventListeners(),console.log("Answer Generation: Initialization complete")}createPopup(){console.log("Answer Generation: createPopup called"),this.removePopup();const e=document.createElement("div");e.id="answer-generation-popup",e.className="answer-generation-popup",console.log("Answer Generation: Created popup element:",e),e.style.cssText="\n      position: fixed !important;\n      z-index: 2147483647 !important;\n      background: white !important;\n      border: 2px solid #3b82f6 !important;\n      border-radius: 8px !important;\n      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;\n      padding: 12px !important;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n      font-size: 14px !important;\n      cursor: pointer !important;\n      opacity: 0 !important;\n      transform: scale(0.8) !important;\n      transition: all 0.2s ease !important;\n      pointer-events: none !important;\n      display: flex !important;\n      align-items: center !important;\n      gap: 8px !important;\n      min-width: 120px !important;\n      justify-content: center !important;\n      background-color: #ffffff !important;\n      color: #374151 !important;\n      font-weight: 600 !important;\n      visibility: hidden !important;\n    ",e.innerHTML='\n      <div style="display: flex; align-items: center; gap: 8px; color: #3b82f6; font-weight: 600;">\n        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"></circle>\n          <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n          <line x1="9" y1="9" x2="9.01" y2="9"></line>\n          <line x1="15" y1="9" x2="15.01" y2="9"></line>\n        </svg>\n        <span>Answer</span>\n      </div>\n    ',console.log("Answer Generation: Popup innerHTML set:",e.innerHTML),document.body.appendChild(e),console.log("Answer Generation: Popup appended to body"),this.popupElement=e,console.log("Answer Generation: Popup element stored:",this.popupElement);const t=document.getElementById("answer-generation-popup");let n;console.log("Answer Generation: Verified popup in DOM:",t),e.addEventListener("mouseenter",()=>{console.log("Answer Generation: Mouse entered popup"),clearTimeout(n),n=setTimeout(()=>{this.showFullMenu()},300)}),e.addEventListener("mouseleave",()=>{console.log("Answer Generation: Mouse left popup"),clearTimeout(n)}),console.log("Answer Generation: Hover event listeners added")}removePopup(){const e=document.getElementById("answer-generation-popup");e&&e.remove(),this.popupElement=null}addEventListeners(){let e;console.log("Answer Generation: Adding event listeners"),document.addEventListener("mouseup",()=>{clearTimeout(e),e=setTimeout(()=>{this.handleTextSelection()},100)}),document.addEventListener("keyup",e=>{"Escape"===e.key&&this.hidePopup()}),document.addEventListener("click",e=>{if(console.log("Answer Generation: Document click detected"),this.popupState.isVisible&&this.popupElement){const t=e.target,n=this.popupElement.contains(t),o=this.isSelection(t);console.log("Answer Generation: Click analysis:",{isPopupClick:n,isSelectionClick:o}),n||o||(console.log("Answer Generation: Hiding popup due to outside click"),this.hidePopup())}}),console.log("Answer Generation: Event listeners added")}isSelection(e){const t=window.getSelection();return(null==t?void 0:t.containsNode(e))||!1}handleTextSelection(){console.log("Answer Generation: Text selection event triggered");const e=window.getSelection();if(!e||e.isCollapsed)return console.log("Answer Generation: No selection or collapsed selection"),void this.hidePopup();const t=e.toString().trim();if(console.log("Answer Generation: Selected text length:",t.length),console.log("Answer Generation: Selected text preview:",t.substring(0,50)),t.length<10)return console.log("Answer Generation: Selection too short (minimum 10 chars)"),void this.hidePopup();this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null,console.log("Answer Generation: Cancelled pending hide timeout")),this.popupState.selectedText=t,console.log("Answer Generation: Storing selected text:",t);const n=e.getRangeAt(0).getBoundingClientRect();console.log("Answer Generation: Selection rect:",n);const o={x:n.left+n.width/2,y:n.top-10};console.log("Answer Generation: Calculated position:",o),this.showPopup(o)}showPopup(e){if(console.log("Answer Generation: showPopup called with position:",e),!this.popupElement)return void console.log("Answer Generation: Popup element not found!");console.log("Answer Generation: Popup element found:",this.popupElement),this.popupState.position=e,this.popupState.isVisible=!0;const t=Math.max(10,Math.min(e.x-60,window.innerWidth-140)),n=Math.max(10,e.y-50);console.log("Answer Generation: Adjusted position:",{adjustedX:t,adjustedY:n}),console.log("Answer Generation: Window size:",{width:window.innerWidth,height:window.innerHeight}),this.popupElement.style.left=`${t}px`,this.popupElement.style.top=`${n}px`,console.log("Answer Generation: Position styles applied"),this.popupElement.style.opacity="1",this.popupElement.style.transform="scale(1)",this.popupElement.style.pointerEvents="auto",this.popupElement.style.display="flex",this.popupElement.style.visibility="visible",console.log("Answer Generation: Visibility styles applied"),console.log("Answer Generation: Current popup state:",{opacity:this.popupElement.style.opacity,display:this.popupElement.style.display,visibility:this.popupElement.style.visibility,left:this.popupElement.style.left,top:this.popupElement.style.top}),this.popupElement.offsetHeight,console.log("Answer Generation: Popup should now be visible"),setTimeout(()=>{this.popupState.isVisible&&(console.log("Answer Generation: Minimum display time elapsed, scheduling hide"),this.scheduleHide())},1e3)}scheduleHide(){console.log("Answer Generation: Scheduling popup hide in 5 seconds"),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{console.log("Answer Generation: Auto-hiding popup after timeout"),this.hidePopup()},5e3)}hidePopup(){console.log("Answer Generation: hidePopup called",{isVisible:this.popupState.isVisible,hasElement:!!this.popupElement}),this.popupElement&&this.popupState.isVisible?(console.log("Answer Generation: Hiding popup"),this.popupElement.style.opacity="0",this.popupElement.style.transform="scale(0.8)",this.popupElement.style.pointerEvents="none",this.popupElement.style.visibility="hidden",setTimeout(()=>{this.popupElement&&(this.popupElement.style.display="none",console.log("Answer Generation: Popup display set to none"))},200),this.popupState.isVisible=!1):console.log("Answer Generation: Skipping hide - not visible or no element"),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null,console.log("Answer Generation: Cleared hide timeout"))}testPopup(){console.log("Answer Generation: Manual test popup called");const e={x:200,y:200};this.popupState.selectedText="This is test text for popup verification. Select any text to test the real functionality.",console.log("Answer Generation: Showing test popup at position:",e),this.showPopup(e),console.log("Answer Generation: Test popup displayed - now try selecting real text!")}debugPopup(){console.log("Answer Generation: Debug popup state:",{popupElement:this.popupElement,popupState:this.popupState,isInDOM:!!document.getElementById("answer-generation-popup"),computedStyles:this.popupElement?window.getComputedStyle(this.popupElement):null})}showFullMenu(){console.log("Answer Generation: showFullMenu called"),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.popupElement?(console.log("Answer Generation: Sending OPEN_ANSWER_GENERATION_MENU message"),chrome.runtime.sendMessage({type:"OPEN_ANSWER_GENERATION_MENU",data:{selectedText:this.popupState.selectedText,position:this.popupState.position}},e=>{console.log("Answer Generation: Message response:",e)})):console.log("Answer Generation: Popup element not found in showFullMenu")}};window.testAnswerGenerationPopup=()=>e.testPopup(),window.debugAnswerGenerationPopup=()=>e.debugPopup(),console.log("Answer Generation: Test methods available:"),console.log("- window.testAnswerGenerationPopup() - Test popup manually"),console.log("- window.debugAnswerGenerationPopup() - Debug popup state"),chrome.runtime.onMessage.addListener((t,n,o)=>{console.log("Answer Generation: Received message:",t),"HIDE_ANSWER_POPUP"===t.type&&(console.log("Answer Generation: Hiding popup via message"),e.hidePopup()),o({status:"ok"})})})();