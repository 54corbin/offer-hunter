(()=>{"use strict";console.log("Offer Hunter autofill script loaded and ready.");const e={"personalInfo.name":["name","full-name","fullName"],"personalInfo.email":["email","email-address","emailAddress"],"personalInfo.phone":["phone","phone-number","phoneNumber"],"personalInfo.gender":["gender"]},o=(e,o)=>{const t=o.split(".");let n=e;for(const e of t){if(!n||"object"!=typeof n||!(e in n))return;n=n[e]}return"string"==typeof n?n:void 0},t=e=>{var o,t,n,l,r,i,s;if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t)return(null===(o=t.textContent)||void 0===o?void 0:o.trim())||null}if("LABEL"===(null===(t=e.parentElement)||void 0===t?void 0:t.tagName))return(null===(n=e.parentElement.textContent)||void 0===n?void 0:n.trim())||null;const a=e.previousElementSibling;return a&&"LABEL"===a.tagName?(null===(l=a.textContent)||void 0===l?void 0:l.trim())||null:"LABEL"===(null===(i=null===(r=e.parentElement)||void 0===r?void 0:r.previousElementSibling)||void 0===i?void 0:i.tagName)?(null===(s=e.parentElement.previousElementSibling.textContent)||void 0===s?void 0:s.trim())||null:(console.warn("Could not find a label for textarea:",e),null)};chrome.runtime.onMessage.addListener((n,l,r)=>{if("AUTOFILL_DATA"===n.type){const{profile:l,resume:i}=n;if(l&&i){const n=(t=>{console.log("Autofilling simple fields with profile:",t);const n=document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"]');let l=0;return n.forEach(n=>{var r,i,s,a;const u=n,c=[(null===(r=u.id)||void 0===r?void 0:r.toLowerCase())||"",(null===(i=u.name)||void 0===i?void 0:i.toLowerCase())||"",(null===(s=u.placeholder)||void 0===s?void 0:s.toLowerCase())||"",(null===(a=u.ariaLabel)||void 0===a?void 0:a.toLowerCase())||""].filter(Boolean);for(const n in e){const r=e[n];if(c.some(e=>r.some(o=>e.includes(o)))){const e=o(t,n);e&&(u.value=e,l++);break}}}),l})(l),i=(e=>{console.log("Autofilling select fields with profile:",e);const o=document.querySelectorAll("select");let t=0;const n=(e=>{const o={};for(const[t,n]of Object.entries(e.personalInfo))"string"==typeof n&&(o[t]=n);if(e.experience.length>0){const t=e.experience[0];for(const[e,n]of Object.entries(t))"string"==typeof n&&(o[e]=n)}if(e.education.length>0){const t=e.education[0];for(const[e,n]of Object.entries(t))"string"==typeof n&&(o[e]=n)}return e.skills.length>0&&(o.skills=e.skills.join(", ")),o})(e),l=Object.keys(n);return o.forEach(e=>{var o,r,i;const s=e,a=[(null===(o=s.id)||void 0===o?void 0:o.toLowerCase())||"",(null===(r=s.name)||void 0===r?void 0:r.toLowerCase())||"",(null===(i=s.ariaLabel)||void 0===i?void 0:i.toLowerCase())||""].filter(Boolean).join(" "),u=l.find(e=>a.includes(e.toLowerCase()));if(u){const e=n[u];if(e)for(let o=0;o<s.options.length;o++){const n=s.options[o],l=n.text.toLowerCase(),r=n.value.toLowerCase(),i=e.toLowerCase();if(r===i||l===i){s.value=n.value,t++;break}if(l.includes(i)||i.includes(l)){s.value=n.value,t++;break}}}}),t})(l);(()=>{const e=document.querySelectorAll("textarea");console.log(`Found ${e.length} textarea(s) to analyze.`),e.forEach(e=>{const o=t(e);if(o){e.placeholder="Generating answer with AI...";const t=document.body.innerText||"";console.log(`Requesting answer for question: "${o}"`),chrome.runtime.sendMessage({type:"GENERATE_ANSWER",questionText:o,jobDescription:t})}})})(),r({status:`success, ${n+i} fields filled.`})}else r({status:"error",message:"Profile or resume data missing."})}else if("ANSWER_GENERATED"===n.type){const{questionText:e,answer:o}=n;document.querySelectorAll("textarea").forEach(n=>{t(n)===e&&(n.value=o,n.placeholder="Answer generated by Offer Hunter AI.")})}else if("ANSWER_FAILED"===n.type){const{questionText:e}=n;document.querySelectorAll("textarea").forEach(o=>{t(o)===e&&(o.placeholder="Could not generate an answer. Please try again.")})}return!0})})();