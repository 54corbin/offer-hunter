<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Answer Generation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .console {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .button-test {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button-test:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>üéØ Final Answer Generation Test</h1>
    
    <div class="test-section">
        <h2>üìã Test Instructions:</h2>
        <ol>
            <li>This page tests the enhanced error handling</li>
            <li>The extension should load the content script automatically</li>
            <li>Select text below to trigger the AI icon</li>
            <li>Click the "Generate Answer" button to test the fix</li>
            <li>Check console output below for success/error messages</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üìù Test Content - Select This Text:</h2>
        <p id="test-content">
            Senior Frontend Developer - We are seeking a talented Frontend Developer 
            with 3+ years of experience in React, TypeScript, and modern JavaScript. 
            The ideal candidate will have experience with responsive design, accessibility, 
            and cross-browser compatibility. Knowledge of testing frameworks like Jest 
            and Cypress is a plus.
        </p>
        
        <h3>Responsibilities:</h3>
        <ul>
            <li>Develop responsive web applications using React and TypeScript</li>
            <li>Collaborate with designers and backend developers</li>
            <li>Write clean, maintainable, and well-tested code</li>
            <li>Optimize applications for maximum speed and scalability</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üß™ Manual Test Buttons:</h2>
        <button class="button-test" onclick="testWrapperAvailability()">Test Wrapper Availability</button>
        <button class="button-test" onclick="testManagerAvailability()">Test Manager Availability</button>
        <button class="button-test" onclick="testGenerateAnswer()">Test Generate Answer</button>
        <button class="button-test" onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="console" id="console">
        <h3>üîß Console Output:</h3>
        <div id="console-content">Initializing test environment...</div>
    </div>

    <script>
        // Enhanced console logging
        const consoleContent = document.getElementById('console-content');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${timestamp}] ${message}`;
            consoleContent.appendChild(div);
            consoleContent.scrollTop = consoleContent.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            addLog(`LOG: ${message}`, 'info');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            addLog(`ERROR: ${message}`, 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            addLog(`WARNING: ${message}`, 'warning');
        };

        // Test functions
        function testWrapperAvailability() {
            addLog('=== Testing Wrapper Availability ===', 'info');
            
            if (typeof window.safeAnswerGenerationManager !== 'undefined') {
                addLog('‚úÖ safeAnswerGenerationManager is available', 'success');
                
                const methods = ['generateAnswer', 'copyAnswer', 'exportAnswer'];
                methods.forEach(method => {
                    if (typeof window.safeAnswerGenerationManager[method] === 'function') {
                        addLog(`‚úÖ Method ${method} is available`, 'success');
                    } else {
                        addLog(`‚ùå Method ${method} is NOT available`, 'error');
                    }
                });
            } else {
                addLog('‚ùå safeAnswerGenerationManager is NOT available', 'error');
            }

            if (typeof window.AGWrapper !== 'undefined') {
                addLog('‚úÖ AGWrapper (backup) is available', 'success');
            } else {
                addLog('‚ùå AGWrapper (backup) is NOT available', 'error');
            }
        }

        function testManagerAvailability() {
            addLog('=== Testing Manager Availability ===', 'info');
            
            if (typeof window.answerGenerationManager !== 'undefined') {
                addLog('‚úÖ answerGenerationManager is available', 'success');
                
                const methods = ['generateAnswer', 'copyAnswer', 'exportAnswer'];
                methods.forEach(method => {
                    if (typeof window.answerGenerationManager[method] === 'function') {
                        addLog(`‚úÖ Manager method ${method} is available`, 'success');
                    } else {
                        addLog(`‚ùå Manager method ${method} is NOT available`, 'warning');
                    }
                });
            } else {
                addLog('‚ö†Ô∏è answerGenerationManager is NOT available yet (may be loading)', 'warning');
            }
        }

        function testGenerateAnswer() {
            addLog('=== Testing Generate Answer ===', 'info');
            
            try {
                if (window.safeAnswerGenerationManager && window.safeAnswerGenerationManager.generateAnswer) {
                    addLog('Calling safeAnswerGenerationManager.generateAnswer()...', 'info');
                    const result = window.safeAnswerGenerationManager.generateAnswer();
                    addLog('‚úÖ generateAnswer called successfully', 'success');
                    console.log('Result:', result);
                } else if (window.AGWrapper && window.AGWrapper.generateAnswer) {
                    addLog('Using backup AGWrapper...', 'info');
                    const result = window.AGWrapper.generateAnswer();
                    addLog('‚úÖ generateAnswer called via backup wrapper', 'success');
                    console.log('Result:', result);
                } else {
                    addLog('‚ùå No wrapper available for generateAnswer', 'error');
                }
            } catch (error) {
                addLog(`‚ùå Error calling generateAnswer: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        function clearConsole() {
            consoleContent.innerHTML = '<h3>üîß Console Output:</h3><div class="info">[Console cleared]</div>';
        }

        // Auto-test on page load
        setTimeout(() => {
            addLog('Auto-testing wrapper availability...', 'info');
            testWrapperAvailability();
            testManagerAvailability();
        }, 1000);

        // Periodic checks
        setInterval(() => {
            if (!window.answerGenerationManager) {
                testManagerAvailability();
            }
        }, 3000);

        addLog('Test page loaded and ready!', 'success');
    </script>
</body>
</html>